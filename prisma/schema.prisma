// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      Role     @default(PUBLISHER)
  createdAt DateTime @default(now())
}

enum Role {
  SUPER_ADMIN
  PUBLISHER
}

model Publisher {
  id        String   @id @default(uuid())
  name      String
  screens   Screen[]
  createdAt DateTime @default(now())
}

model Screen {
  id           String             @id @default(uuid())
  name         String
  location     String?
  publisherId  String
  publisher    Publisher          @relation(fields: [publisherId], references: [id])
  interactions InteractionEvent[]
  createdAt    DateTime           @default(now())

  @@index([publisherId])
}

model InteractionEvent {
  id          String    @id @default(uuid())
  screenId    String
  screen      Screen    @relation(fields: [screenId], references: [id])
  color       String // Hex or Name
  userName    String?
  deviceHash  String // Fingerprint for rate-limiting
  timestamp   DateTime  @default(now())
  clickedAt   DateTime? // When user clicked the splash button
  displayedAt DateTime? // When splash appeared on billboard screen

  // Speeds up stats queries that filter/group by screenId + timing columns
  @@index([screenId, clickedAt, displayedAt])
  // Speeds up deviceHash lookups if rate-limiting ever falls back to DB
  @@index([deviceHash])
}
